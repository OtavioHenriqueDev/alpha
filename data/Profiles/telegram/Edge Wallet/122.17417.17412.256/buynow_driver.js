!function(){"use strict";let e,t,i,o=!1;!function(e){e.IsBuyNowReady="IsBuyNowReady",e.BuyNowSubscribeNow="BuyNowSubscribeNow",e.BuyNowQuickAuthFinished="BuyNowQuickAuthFinished",e.BuyNowQuickAuthFailed="BuyNowQuickAuthFailed",e.LoadLocalCards="LoadLocalCards",e.BuyNowIsReady="BuyNowIsReady",e.BuyNowStartQuickAuth="BuyNowStartQuickAuth",e.BuyNowCheckoutFinished="BuyNowCheckoutFinished",e.LoadLocalCardsFinished="LoadLocalCardsFinished"}(t||(t={})),function(e){e.EntryPointReady="EntryPointReady",e.StartBuyNow="StartBuyNow",e.VisitPublisher="VisitPublisher",e.MerchantAuthSucceeded="MerchantAuthSucceeded",e.MerchantAuthFailed="MerchantAuthFailed",e.LoadLocalCards="LoadLocalCards"}(i||(i={}));const s="BuyNowRuntime";window[s]=new class{notifyHostPage(e,t){window.dispatchEvent(new CustomEvent(e,{detail:t}))}listenOnHostPageEvent(e,t){window.addEventListener(e,(e=>{t(e)}))}handleQuickAuthFinished(e){if(e.detail){const t=JSON.parse(e.detail);"skipped"===t.type?window[s].postMessageToHost(i.MerchantAuthFailed,[]):"display"!==t.type||t.displayed?"dismissed"===t.type&&"credential_returned"===t.reason&&window[s].postMessageToHost(i.MerchantAuthSucceeded,[]):window[s].postMessageToHost(i.MerchantAuthFailed,[])}}handleQuickAuthFailed(e){window[s].postMessageToHost(i.MerchantAuthFailed,[])}handleIsBuyNowReady(){window[s].notifyHostPage(t.BuyNowIsReady,"Ready"),window[s].postMessageToHost(i.EntryPointReady,[])}handleBuyNowSubscribeNow(t){window[s].postMessageToHost(i.StartBuyNow,[t.detail]),e=JSON.parse(t.detail)}handleLoadLocalCards(){window[s].postMessageToHost(i.LoadLocalCards,[])}raiseMessageFromHost(i){const o=i.shift(),a=JSON.parse(i[0]).event;if(o&&"StartMerchantAuth"===o)this.listenOnHostPageEvent(t.BuyNowQuickAuthFinished,this.handleQuickAuthFinished),this.listenOnHostPageEvent(t.BuyNowQuickAuthFailed,this.handleQuickAuthFailed),this.notifyHostPage(t.BuyNowStartQuickAuth,a);else if(o&&"VisitPublisher"===o){if(e&&e.plans){if(e.originalSubLink)return void window.open(e.originalSubLink,"_blank").focus();let t=0;for(let i=0;i<e.length;i+=1)if(e.plans[i].isPromotion){t=i;break}if(e.plans[t].url){const i=new URL(e.plans[t].url);window.open(i.origin,"_blank").focus()}}}else o&&"CheckoutFinished"===o?window[s].notifyHostPage(t.BuyNowCheckoutFinished,a):o&&"LocalCardsFinished"==o&&window[s].notifyHostPage(t.LoadLocalCardsFinished,a)}postMessageToHost(e,t){try{walletBuyNowNativeHandler&&walletBuyNowNativeHandler.sendMessageToHost(e,t)}catch(e){}}initialize(e){return o||(this.listenOnHostPageEvent(t.IsBuyNowReady,this.handleIsBuyNowReady),this.listenOnHostPageEvent(t.BuyNowSubscribeNow,this.handleBuyNowSubscribeNow),this.listenOnHostPageEvent(t.LoadLocalCards,this.handleLoadLocalCards),o=!0),!0}}}();